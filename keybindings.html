
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DWM Keybindings Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .key {
            display: inline-block;
            background-color: #374151; /* gray-700 */
            color: #F3F4F6; /* gray-100 */
            padding: 0.2rem 0.5rem;
            border-radius: 0.375rem; /* rounded-md */
            border-bottom: 2px solid #1F2937; /* gray-800 */
            font-family: monospace;
            font-size: 0.85em;
            margin: 0 0.125rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            white-space: nowrap;
        }
        /* Container is now a positioning context */
        #keybindings-container {
            position: relative;
            transition: height 0.3s ease;
        }
        .keybinding-card {
            /* Cards are now positioned by JS */
            position: absolute;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        /* Simple scrollbar styling */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1F2937; }
        ::-webkit-scrollbar-thumb { background: #4B5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6B7280; }
        
        /* Gemini Modal Styles */
        #gemini-modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        #gemini-modal-panel {
            transition: all 0.3s ease-in-out;
        }
        .gemini-response pre {
            background-color: #111827; /* gray-900 */
            padding: 1rem;
            border-radius: 0.5rem; /* rounded-lg */
            overflow-x: auto;
            border: 1px solid #374151; /* gray-700 */
        }
        .gemini-response code {
            font-family: monospace;
            font-size: 0.9em;
        }
        .gemini-response p { margin-bottom: 0.75rem; }
        .gemini-response ul { list-style-position: inside; list-style-type: disc; margin-left: 0.5rem; margin-bottom: 0.75rem; }
        
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #4f46e5;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div class="container mx-auto p-4 md:p-6 max-w-full">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-white">DWM Keybindings Dashboard</h1>
        </header>

        <main>
            <!-- Search Input -->
            <div class="mb-6 sticky top-4 z-10">
                 <input type="text" id="searchInput" placeholder="Type to search..." class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-base text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-300">
            </div>

            <!-- Keybindings Grid Container -->
            <div id="keybindings-container">
                <!-- Content will be dynamically generated here -->
            </div>
             <div id="no-results" class="text-center p-8 text-gray-500 text-xl hidden col-span-full">
                <p>No matching keybindings found.</p>
            </div>
        </main>
    </div>

    <!-- Gemini AI Helper Modal -->
    <div id="gemini-modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div id="gemini-modal-panel" class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex items-center justify-between p-4 border-b border-gray-700">
                <h2 id="gemini-modal-title" class="text-xl font-bold text-white">✨ AI Helper</h2>
                <button id="gemini-modal-close" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <div id="gemini-modal-content" class="p-6 overflow-y-auto flex-grow">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>
    
    <!-- AI Helper Floating Action Button -->
    <button id="ai-helper-btn" title="Open AI Helper" class="fixed bottom-6 right-6 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-lg transition-transform transform hover:scale-110">
        <span class="text-2xl">✨</span>
    </button>

    <script>
        // --- DATA SOURCE ---
        const keybindingGroups = [
            { groupName: "Application Launchers", bindings: [ { keys: ["Super", "Ctrl", "Space"], description: "Launch dmenu" }, { keys: ["Ctrl", "Space"], description: "Launch rofi" }, { keys: ["Ctrl", "Shift", "Enter"], description: "Launch wezterm (terminal)" }, { keys: ["Ctrl", "Shift", "Space"], description: "Toggle keyboard layout" }, { keys: ["PrintScreen"], description: "Screenshot selected area to clipboard" } ] },
            { groupName: "Layout Management", bindings: [ { keys: ["Super", "t"], description: "Set tiling layout ([]=)" }, { keys: ["Super", "f"], description: "Set floating layout (><>)" }, { keys: ["Super", "m"], description: "Set monocle layout ([M])" }, { keys: ["Super", "c"], description: "Set deck layout ([D])" }, { keys: ["Super", "p"], description: "Toggle previous layout" } ] },
            { groupName: "Window Management", bindings: [ { keys: ["Ctrl", "q"], description: "Close focused window" }, { keys: ["Super", "j"], description: "Focus next window" }, { keys: ["Super", "k"], description: "Focus previous window" }, { keys: ["Super", "Shift", "Enter"], description: "Swap with master" }, { keys: ["Super", "Shift", "Space"], description: "Toggle floating" }, { keys: ["Super", "h"], description: "Decrease master area size" }, { keys: ["Super", "l"], description: "Increase master area size" }, { keys: ["Super", "i"], description: "Increase master windows" }, { keys: ["Super", "d"], description: "Decrease master windows" }, ] },
            { groupName: "Tag & Workspace Management", bindings: [ { keys: ["Super", "N"], description: "View tag N (1-9)" }, { keys: ["Super", "Shift", "N"], description: "Move window to tag N" }, { keys: ["Super", "Ctrl", "N"], description: "Toggle view of tag N" }, { keys: ["Super", "Ctrl", "Shift", "N"], description: "Toggle tag on window" }, { keys: ["Super", "0"], description: "View all tags" }, { keys: ["Super", "Shift", "0"], description: "Tag window on all tags" }, { keys: ["Super", "Tab"], description: "Switch to previous tag" } ] },
            { groupName: "Monitor Management", bindings: [ { keys: ["Super", ","], description: "Focus previous monitor" }, { keys: ["Super", "."], description: "Focus next monitor" }, { keys: ["Super", "Shift", ","], description: "Move window to prev monitor" }, { keys: ["Super", "Shift", "."], description: "Move window to next monitor" } ] },
            { groupName: "System & DWM Control", bindings: [ { keys: ["Super", "b"], description: "Toggle status bar" }, { keys: ["Super", "Shift", "q"], description: "Quit dwm" }, { keys: ["Super", "Shift", "r"], description: "Restart dwm in-place" }, { keys: ["AudioMute"], description: "Toggle volume mute" }, { keys: ["AudioRaiseVolume"], description: "Increase volume" }, { keys: ["AudioLowerVolume"], description: "Decrease volume" }, { keys: ["MonBrightnessUp"], description: "Increase brightness" }, { keys: ["MonBrightnessDown"], description: "Decrease brightness" } ] }
        ];

        // --- DOM Elements ---
        const container = document.getElementById('keybindings-container');
        const searchInput = document.getElementById('searchInput');
        const noResultsDiv = document.getElementById('no-results');
        const modalOverlay = document.getElementById('gemini-modal-overlay');
        const modalPanel = document.getElementById('gemini-modal-panel');
        const modalTitle = document.getElementById('gemini-modal-title');
        const modalContent = document.getElementById('gemini-modal-content');
        const modalCloseBtn = document.getElementById('gemini-modal-close');
        const aiHelperBtn = document.getElementById('ai-helper-btn');

        // --- Gemini API Logic ---
        const API_KEY = ""; // Kept empty as per instructions
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
        
        async function callGeminiAPI(prompt, systemPrompt) {
            let retries = 3;
            let delay = 1000;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
            };

            if (systemPrompt) {
                 payload.systemInstruction = { parts: [{ text: systemPrompt }] };
            }

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!text) throw new Error("Invalid response from API.");

                    return marked.parse(text);

                } catch (error) {
                    if (i === retries - 1) {
                         return `<p class="text-red-400">An error occurred after multiple retries. Please check the console for details.</p>`;
                    }
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2; // Exponential backoff
                }
            }
        }
        
        // --- Modal Logic ---
        function showModal(title, content) {
            modalTitle.textContent = title;
            modalContent.innerHTML = content;
            modalOverlay.classList.remove('opacity-0', 'pointer-events-none');
            modalPanel.classList.remove('scale-95');
        }

        function hideModal() {
            modalOverlay.classList.add('opacity-0', 'pointer-events-none');
            modalPanel.classList.add('scale-95');
        }
        
        // --- Event Handlers ---
        async function handleExplainClick(description) {
            showModal(`✨ Explaining: ${description}`, '<div class="flex justify-center items-center h-40"><span class="loader"></span></div>');
            const systemPrompt = "You are an expert on the dwm window manager and related command-line tools. Explain what the command or function does. Keep the explanation concise (2-4 sentences) and easy for a new user to understand. Focus on its purpose within a typical dwm workflow.";
            const response = await callGeminiAPI(description, systemPrompt);
            modalContent.innerHTML = `<div class="gemini-response">${response}</div>`;
        }
        
        function openAiHelper() {
            showModal('✨ AI Helper', `
                <div class="flex flex-col h-full">
                    <p class="mb-2 text-sm text-gray-400">Ask anything about dwm, Linux, or shell commands.</p>
                    <textarea id="ai-prompt" class="w-full p-2 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4" rows="4" placeholder="e.g., How do I create a shell script to list all files in a directory?"></textarea>
                    <button id="ai-generate" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Generate</button>
                    <div id="ai-response" class="mt-4 flex-grow overflow-y-auto gemini-response bg-gray-900/50 p-4 rounded-lg border border-gray-700/50"></div>
                </div>
            `);
            
            document.getElementById('ai-generate').addEventListener('click', async () => {
                const prompt = document.getElementById('ai-prompt').value;
                const responseDiv = document.getElementById('ai-response');
                if (!prompt) return;
                
                responseDiv.innerHTML = '<div class="flex justify-center items-center h-20"><span class="loader"></span></div>';
                const systemPrompt = "You are a helpful assistant specializing in dwm, Linux, and shell scripting. Please answer the following question clearly and concisely. Format code blocks appropriately using Markdown.";
                const response = await callGeminiAPI(prompt, systemPrompt);
                responseDiv.innerHTML = response;
            });
        }
        
        modalCloseBtn.addEventListener('click', hideModal);
        aiHelperBtn.addEventListener('click', openAiHelper);


        // --- Layout and Rendering Logic ---
        function reflowLayout() {
            // ... (masonry layout logic remains the same)
            const cards = Array.from(container.querySelectorAll('.keybinding-card'));
            if (cards.length === 0) { container.style.height = 'auto'; return; }
            const containerWidth = container.offsetWidth;
            const minCardWidth = 380;
            const gap = 16;
            const numColumns = Math.max(1, Math.floor((containerWidth + gap) / (minCardWidth + gap)));
            const actualCardWidth = (containerWidth - (numColumns - 1) * gap) / numColumns;
            const columnHeights = Array(numColumns).fill(0);
            cards.forEach(card => card.style.width = `${actualCardWidth}px`);
            cards.forEach(card => {
                const shortestColumnIndex = columnHeights.indexOf(Math.min(...columnHeights));
                const top = columnHeights[shortestColumnIndex];
                const left = shortestColumnIndex * (actualCardWidth + gap);
                card.style.transform = `translate3d(${left}px, ${top}px, 0)`;
                columnHeights[shortestColumnIndex] += card.offsetHeight + gap;
            });
            container.style.height = `${Math.max(...columnHeights)}px`;
        }

        function renderKeybindings(groups) {
            container.innerHTML = '';
            let hasResults = false;
            groups.forEach(group => {
                if (group.bindings.length === 0) return;
                hasResults = true;
                const groupDiv = document.createElement('div');
                groupDiv.className = 'bg-gray-800/50 p-4 rounded-lg shadow-lg keybinding-card';
                const groupTitle = document.createElement('h2');
                groupTitle.className = 'text-xl font-semibold text-green-400 mb-4 border-b border-gray-700 pb-2';
                groupTitle.textContent = group.groupName;
                groupDiv.appendChild(groupTitle);
                const table = document.createElement('table');
                table.className = 'w-full text-left';
                const tbody = document.createElement('tbody');
                group.bindings.forEach(binding => {
                    const row = tbody.insertRow();
                    row.className = 'border-b border-gray-800 last:border-b-0';
                    const keysCell = row.insertCell();
                    keysCell.className = 'py-2 pr-2 w-1/2';
                    keysCell.innerHTML = binding.keys.map(key => `<span class="key">${key}</span>`).join(' + ');
                    
                    const descCell = row.insertCell();
                    descCell.className = 'py-2 pl-2 text-gray-300 text-sm flex items-center justify-between';
                    
                    const descText = document.createElement('span');
                    descText.textContent = binding.description;
                    
                    const explainBtn = document.createElement('button');
                    explainBtn.className = 'ml-2 text-lg opacity-60 hover:opacity-100 hover:scale-125 transition-transform';
                    explainBtn.textContent = '✨';
                    explainBtn.title = `✨ Explain "${binding.description}"`;
                    explainBtn.onclick = () => handleExplainClick(binding.description);
                    
                    descCell.appendChild(descText);
                    descCell.appendChild(explainBtn);
                });
                table.appendChild(tbody);
                groupDiv.appendChild(table);
                container.appendChild(groupDiv);
            });
            noResultsDiv.classList.toggle('hidden', !hasResults);
            if (!hasResults) { container.appendChild(noResultsDiv); }
            setTimeout(reflowLayout, 50);
        }

        function filterKeybindings() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (!searchTerm) {
                renderKeybindings(keybindingGroups);
                return;
            }
            const filteredGroups = keybindingGroups.map(group => {
                const filteredBindings = group.bindings.filter(binding => {
                    const keysString = binding.keys.join(' ').toLowerCase();
                    const descMatch = binding.description.toLowerCase().includes(searchTerm);
                    return keysString.includes(searchTerm) || descMatch;
                });
                return { ...group, bindings: filteredBindings };
            }).filter(group => group.bindings.length > 0);
            renderKeybindings(filteredGroups);
        }
        
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        searchInput.addEventListener('input', filterKeybindings);
        window.addEventListener('resize', debounce(reflowLayout, 150));
        document.addEventListener('DOMContentLoaded', () => {
            renderKeybindings(keybindingGroups);
        });
    </script>
</body>
</html>

